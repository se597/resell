<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ë“±ë¡</title>
    <!-- ê³µí†µ í—¤ë” CSS -->
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<!-- ë“±ë¡í¼ CSS -->
    <link rel="stylesheet" th:href="@{/css/form.css}">
    
</head>
<body>
<div th:replace="layout/header :: siteHeader"></div>
<div class="page-content">
    <h2>ìƒí’ˆ ë“±ë¡</h2>

    <form th:action="@{/content/add}" method="post" enctype="multipart/form-data"
    	onsubmit="return validateForm()">
        
        <div class="form-line">
            <label>ìƒí’ˆëª…</label>
            <input type="text" name="product_name" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <div class="form-line">
            <label>ê°€ê²©</label>
            <input type="number" name="price" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <div class="form-line">
            <label>ì œëª©</label>
            <input type="text" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <div class="form-line">
            <label>ì‘ì„±ì</label>
            <input type="text" name="writer" th:value="${session.login?.nickname}" readonly>
        </div>

        <div class="form-line">
            <label>ë‚´ìš©</label>
            <textarea name="content" rows="6" placeholder="ìƒí’ˆ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>

        <div class="form-line">
            <label>íŒŒì¼ 1</label>
            <input type="file" name="upload1">
        </div>

        <div class="form-line">
            <label>íŒŒì¼ 2</label>
            <input type="file" name="upload2">
        </div>

        <div class="form-line">
            <label>íŒŒì¼ 3</label>
            <input type="file" name="upload3">
        </div>

        <div class="form-line">
            <label>ì¹´í…Œê³ ë¦¬ 1</label>
            <select id="cat1" name="cat1_id" onchange="cat2_activate()" required>
                <option value="">-- ì„ íƒ --</option>
                <option th:each="cat : ${cat1List}" 
                        th:value="${cat.cat1_id}" 
                        th:text="${cat.cat1_name}">
                </option>
            </select>
        </div>

        <div class="form-line">
            <label>ì¹´í…Œê³ ë¦¬ 2</label>
            <select id="cat2" name="cat2_id" onchange="cat3_activate()" disabled>
                <option value="">-- ì„ íƒ --</option>
            </select>
        </div>

        <div class="form-line">
            <label>ì¹´í…Œê³ ë¦¬ 3</label>
            <select id="cat3" name="cat3_id" disabled>
                <option value="">-- ì„ íƒ --</option>
            </select>
        </div>

        <div class="btn-row">
            <button type="submit" class="btn login-btn">ë“±ë¡í•˜ê¸°</button>
            <button type="button" class="btn join-btn" onclick="location.href='/category'">ëª©ë¡ìœ¼ë¡œ</button>
        </div>
    </form>
</div>
<script>
function cat2_activate(){
	const data = new URLSearchParams();
    data.append('cat1', document.getElementById('cat1').value);
	fetch('/content/api/category2', {
		method: 'POST',
		headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
		body: data
	})
	.then(res => res.json())
	.then(list => {
		const select = document.getElementById('cat2');
		const select2 = document.getElementById('cat3');
	    select.disabled = false;
	    select.innerHTML = '';
	    select2.disabled = true;
	    select2.innerHTML = '';
	    const defaultoption1 = document.createElement('option');
	    const defaultoption2 = document.createElement('option');
	    defaultoption1.value = '';
	    defaultoption2.value = '';
	    defaultoption1.textContent = '-- ì„ íƒ --';
	    defaultoption2.textContent = '-- ì„ íƒ --';
	    select.appendChild(defaultoption1);
	    select2.appendChild(defaultoption2);
	    list.forEach(cat => {
	    	const opt = document.createElement('option');
			opt.value = cat.cat2_id;
			opt.textContent = cat.cat2_name;
			select.appendChild(opt);
		});
	})
	.catch(err => console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨', err));
}
	
	function cat3_activate(){
		console.log("didi")
		const data = new URLSearchParams();
	    data.append('cat2', document.getElementById('cat2').value);
		fetch('/content/api/category3', {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: data
		})
		.then(res => res.json())
		.then(list => {
			const select = document.getElementById('cat3');
		    select.disabled = false;
		    select.innerHTML = '';
		    const defaultoption = document.createElement('option');
		    defaultoption.value = '';
		    defaultoption.textContent = '-- ì„ íƒ --';
		    select.appendChild(defaultoption);
		    list.forEach(cat => {
		    	const opt = document.createElement('option');
				opt.value = cat.cat3_id;
				opt.textContent = cat.cat3_name;
				select.appendChild(opt);
			});
		})
		.catch(err => console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨', err));
	}
	
	function validateForm() {
	    const cat1 = document.getElementById('cat1').value;
	    const cat2 = document.getElementById('cat2').value;
	    const cat3 = document.getElementById('cat3').value;

	    if (!cat1 || !cat2 || !cat3) {
	        alert('ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì•¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
	        return false; // ğŸš« í¼ ì œì¶œ ì¤‘ë‹¨
	    }
	    return true; // âœ… í¼ ì œì¶œ ì§„í–‰
	}
</script>
</body>
</html>
