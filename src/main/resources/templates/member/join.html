<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>회원가입</title>
<link rel="stylesheet" th:href="@{/css/join.css}">
<link rel="stylesheet" th:href="@{/css/header.css}">
<script>
let idChecked = false;

function dupl_check() {
  const idInput = document.querySelector("input[name='id']");
  const idValue = idInput.value.trim();

  if (!idValue) {
    alert("아이디를 입력하세요.");
    idChecked = false;
    return;
  }

  fetch(`/dupl_check?id=${encodeURIComponent(idValue)}`)
    .then(response => response.text())
    .then(result => {
      if (result === "true") {
        alert("사용 가능한 아이디입니다.");
        idChecked = true;
      } else {
        alert("이미 존재하는 아이디입니다.");
        idChecked = false;
      }
    })
    .catch(err => {
      alert("서버 오류가 발생했습니다.");
      console.error(err);
      idChecked = false;
    });
}

function idChanged() {
  idChecked = false;
}

function checkFormSubmit(event) {
  if (!idChecked) {
    alert("중복체크를 하고 사용 가능한 아이디를 입력하세요!");
    event.preventDefault();
    return;
  }

  const requiredFields = ["id", "pw", "nickname", "name", "address", "birth", "phone_number", "email"];
  for (let fieldName of requiredFields) {
    const field = document.querySelector(`input[name='${fieldName}']`);
    if (!field || !field.value.trim()) {
      alert(`${fieldName}를 입력하세요.`);
      field.focus();
      event.preventDefault();
      return;
    }
  }
}
</script>
</head>

<body>
<div th:replace="layout/header :: siteHeader"></div>
  <div class="page-content">
    <h2>회원가입</h2>

    <form action="/join" method="post" onsubmit="checkFormSubmit(event)">
      <table>
        <tr>
          <td>아이디</td>
          <td>
            <input type="text" name="id" oninput="idChanged()">
          </td>
          <td>
            <button type="button" onclick="dupl_check()">중복체크</button>
          </td>
        </tr>
        <tr><td>비밀번호</td><td colspan="2"><input type="text" name="pw"></td></tr>
        <tr><td>닉네임</td><td colspan="2"><input type="text" name="nickname"></td></tr>
        <tr><td>이름</td><td colspan="2"><input type="text" name="name"></td></tr>
        <tr><td>주소</td><td colspan="2"><input type="text" name="address"></td></tr>
        <tr><td>생년월일</td><td colspan="2"><input type="text" name="birth" placeholder="YYYY-MM-DD"></td></tr>
        <tr><td>전화번호</td><td colspan="2"><input type="text" name="phone_number"></td></tr>
        <tr><td>이메일</td><td colspan="2"><input type="email" name="email"></td></tr>
      </table>

      <div class="btn-row">
        <input type="submit" value="가입">
        <button type="button" onclick="history.back()">취소</button>
      </div>
    </form>
  </div>
</body>
</html>
